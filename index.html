<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Web Chat + Game B·∫£o V·ªá C√¥ G√°i</title>
<style>
html,body{margin:0;padding:0;width:100%;height:100%;overflow:hidden;font-family:Arial,sans-serif;}
.chat-box{position:fixed;top:10px;left:10px;width:320px;max-height:90%;background:white;padding:20px;border-radius:12px;box-shadow:0 0 10px rgba(0,0,0,0.3);display:flex;flex-direction:column;z-index:1000;}
#messages{flex:1;overflow-y:auto;border:1px solid #ddd;padding:10px;border-radius:8px;margin-bottom:10px;background:#fafafa;}
.msg{padding:6px;margin:5px 0;border-radius:6px;word-wrap:break-word;}
input{width:75%;padding:8px;margin-right:5px;}
button{width:20%;padding:9px;background:#007bff;color:white;border:none;border-radius:6px;cursor:pointer;}
button:hover{background:#0056c1;}
#game-container{position:fixed;top:0;left:0;width:100%;height:100%;display:none;flex-direction:column;align-items:center;justify-content:center;z-index:999;background:black;}
#start-screen{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);display:flex;flex-direction:column;align-items:center;justify-content:center;background:rgba(255,255,255,0.8);padding:20px;border-radius:12px;text-align:center;z-index:1000;}
#start-screen button{padding:10px 20px;font-size:18px;border:none;border-radius:10px;cursor:pointer;margin-top:10px;}
/* N√∫t Bay responsive */
#jump-btn {
    position: fixed;
    bottom: 15%;
    left: 50%;
    transform: translateX(-50%);
    padding: 20px 40px;
    font-size: 24px;
    border: none;
    border-radius: 15px;
    background: #f1c40f;
    color: black;
    font-weight: bold;
    cursor: pointer;
    z-index: 1000;
    display: none;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    transition: transform 0.1s ease;
}
#jump-btn:active {
    transform: translateX(-50%) scale(0.95);
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}
#game-over{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);display:none;flex-direction:column;align-items:center;justify-content:center;background:rgba(0,0,0,0.8);padding:30px;border-radius:12px;text-align:center;color:white;z-index:1001;}
#game-over button{padding:20px 40px;font-size:22px;border:none;border-radius:12px;background:#f1c40f;cursor:pointer;margin-top:20px;}
canvas{display:block;}
</style>
</head>
<body>

<div class="chat-box" id="chat-box">
<h3>L√¥! ƒê√¢y l√† ƒë·ªãa b√†n c·ªßa anh Kh√¥i top1 sever tr√°i ƒë·∫•t</h3>
<div id="messages"></div>
<div style="display:flex;">
<input type="text" id="chat-input" placeholder="Nh·∫≠p tin nh·∫Øn...">
<button id="send-btn">G·ª≠i</button>
</div>
</div>

<div id="game-container">
<div id="start-screen">
<h2>B·∫¢O V·ªÜ C√î G√ÅI KH·ªéI NH·ªÆNG CHI·∫æC GAI BI·∫æN TH√ÅI</h2>
<p>Nh·∫•n Start ƒë·ªÉ b·∫Øt ƒë·∫ßu</p>
<button onclick="startGame()">Start</button>
</div>
<canvas id="game"></canvas>
<button id="jump-btn">Bay</button>
<div id="game-over">
<h1>Game Over!</h1>
<p id="final-score"></p>
<p id="best-score"></p>
<button onclick="restartGame()">L√†m l·∫°i cu·ªôc ƒë·ªùi</button>
</div>
</div>

<audio id="flap-sound" src="flap.mp3"></audio>
<audio id="hit-sound" src="hit.mp3"></audio>
<audio id="point-sound" src="point.mp3"></audio>

<script>
// ===== Chat + m·∫≠t kh·∫©u =====
const GAME_PASSWORD="ƒë√£ ƒë∆∞·ª£c anh kh√¥i cho ph√©p";
function addMessage(text,sender="user"){
    const msg=document.createElement("div");
    msg.className="msg";
    msg.style.background=sender==="WHO"?"#d1e7dd":"#f8d7da";
    msg.innerText=text;
    document.getElementById("messages").appendChild(msg);
    document.getElementById("messages").scrollTop=document.getElementById("messages").scrollHeight;
}
function botReply(text){
    text=text.trim().toLowerCase();
    let reply="IM M·ªíM NGAY !";
    if(text.includes("hi")||text.includes("hey")) reply="sao? üëã";
    else if(text.includes("th√≠ch g√¨")) reply="ƒë·∫øck quan t√¢m";
    else if(text.includes("game")) reply="H·ªéI ANH KH√îI DZ!";
    addMessage(reply,"ƒë·ªá anh Kh√¥i");
}
document.getElementById("send-btn").addEventListener("click",()=>{
    const input=document.getElementById("chat-input");
    const text=input.value;
    if(text.trim()==="") return;
    addMessage(text,"user");
    input.value="";
    botReply(text);
    if(text.trim().toLowerCase()===GAME_PASSWORD.toLowerCase()){
        document.getElementById("chat-box").style.display="none";
        openGame();
    }
});
document.getElementById("chat-input").addEventListener("keydown",e=>{if(e.key==="Enter") document.getElementById("send-btn").click();});

// ===== Game =====
let canvas=document.getElementById("game"),ctx;
let bird,pipes,score,running,anim,shieldActive=false,shieldTimer=0,speed=3;
let lastPipe=0,last=0;
const names=["H√πng","Ho√†ng","Vi·ªát","Ti·∫øn","T√≠n","Khoa","S√°ng","H·∫≠u","Duy","Ph√∫c","ƒêi·ªÅn","Trung","Huy","Th·∫Øng","Quy·ªÅn","Nguy√™n"];
const rainbowColors=["red","orange","yellow","green","blue","indigo","violet"];
let nameIndex=0,colorIndex=0,shieldIcon=null;
let bestScore=parseInt(localStorage.getItem("bestScore")||0);

let bg=new Image(); bg.src="bg.jpg";
let girlImg=new Image(); girlImg.src="girl.png"; 

function resizeCanvas(){ canvas.width=window.innerWidth; canvas.height=window.innerHeight; }
window.addEventListener("resize",resizeCanvas); resizeCanvas();

function openGame(){ document.getElementById("game-container").style.display="flex"; document.getElementById("start-screen").style.display="flex"; ctx=canvas.getContext("2d"); }

function startGame(){
    const startScreen=document.getElementById("start-screen");
    startScreen.innerHTML="<h2>Chu·∫©n b·ªã...</h2><p id='countdown'>3</p>";
    let count=3;
    const countdownElem=document.getElementById("countdown");
    const interval=setInterval(()=>{
        count--;
        if(count>0) countdownElem.innerText=count;
        else{
            clearInterval(interval);
            startScreen.style.display="none";
            document.getElementById("jump-btn").style.display="block";
            initGame();
        }
    },1000);
}

function initGame(){
    ctx=canvas.getContext("2d");
    bird={x:canvas.width/4,y:canvas.height/2,vy:0};
    pipes=[]; score=0; running=true; last=performance.now(); lastPipe=last;
    nameIndex=0; colorIndex=0; shieldActive=false; shieldTimer=0; speed=3;

    // Nh·∫£y v·ªõi Space v√† n√∫t Bay
    window.onkeydown=e=>{if(e.code==="Space"){bird.vy=-7; document.getElementById("flap-sound").play();}}
    const jumpBtn = document.getElementById("jump-btn");
    jumpBtn.style.display="block";
    jumpBtn.onclick = () => { if(running){bird.vy=-7; document.getElementById("flap-sound").play();} }
    jumpBtn.addEventListener("touchstart",(e)=>{ e.preventDefault(); if(running){bird.vy=-7; document.getElementById("flap-sound").play();} });

    anim=requestAnimationFrame(loop);
}

function gameOver(){
    running=false;
    cancelAnimationFrame(anim);
    document.getElementById("jump-btn").style.display="none";
    document.getElementById("hit-sound").play();
    const over=document.getElementById("game-over");
    over.style.display="flex";
    document.getElementById("final-score").innerText="ƒêi·ªÉm c·ªßa b·∫°n: "+score;
    if(score>bestScore){ bestScore=score; localStorage.setItem("bestScore",bestScore);}
    document.getElementById("best-score").innerText="ƒêi·ªÉm cao nh·∫•t: "+bestScore;
}

function restartGame(){ document.getElementById("game-over").style.display="none"; startGame(); }

function drawBackground(){ if(bg.complete) ctx.drawImage(bg,0,0,canvas.width,canvas.height); }

function drawSpike(x,height,name,color){
    const spikeWidth=60;
    ctx.fillStyle=color;
    // top
    ctx.beginPath();
    ctx.moveTo(x,0); ctx.lineTo(x+spikeWidth/2,height); ctx.lineTo(x+spikeWidth,0); ctx.closePath(); ctx.fill();
    // bottom
    ctx.beginPath();
    ctx.moveTo(x,canvas.height); ctx.lineTo(x+spikeWidth/2,canvas.height-height); ctx.lineTo(x+spikeWidth,canvas.height); ctx.closePath(); ctx.fill();
    // name
    ctx.fillStyle="white"; ctx.font="16px Arial";
    ctx.fillText(name,x,canvas.height-5);
}

function spawnShield(){ shieldIcon={x:Math.random()*(canvas.width-50)+25,y:50,width:40,height:40}; }

function loop(t){
    if(!running) return;
    const dt=t-last; last=t;
    drawBackground();

    bird.vy+=0.35; bird.y+=bird.vy;
    if(bird.y>canvas.height-20) bird.y=canvas.height-20,bird.vy=0;
    if(bird.y<20) bird.y=20,bird.vy=0;
    if(girlImg.complete) ctx.drawImage(girlImg,bird.x-16,bird.y-16,32,32);

    if(t-lastPipe>1500){
        lastPipe=t;
        let minH=60,maxH=canvas.height-200;
        let h=Math.floor(Math.random()*(maxH-minH)+minH);
        pipes.push({x:canvas.width,y:h,name:names[nameIndex],color:rainbowColors[colorIndex],passed:false});
        nameIndex=(nameIndex+1)%names.length;
        colorIndex=(colorIndex+1)%rainbowColors.length;
    }

    pipes.forEach(p=>p.x-=speed);
    pipes=pipes.filter(p=>p.x>-70);

    pipes.forEach(p=>{
        drawSpike(p.x,150,p.name,p.color);
        if(bird.x+16>p.x && bird.x-16<p.x+60){
            if(bird.y>canvas.height-150 || bird.y<150){gameOver(); return;}
        }
        if(!p.passed && p.x+60<bird.x){ p.passed=true; score++; document.getElementById("point-sound").play();}
    });

    if(shieldIcon){
        ctx.fillStyle="blue"; ctx.font="28px Arial";
        ctx.fillText("üï¥Ô∏è",shieldIcon.x,shieldIcon.y);
        ctx.fillText("Kh√¥i DZ",shieldIcon.x-20,shieldIcon.y+30);
        if(bird.x>shieldIcon.x-20 && bird.x<shieldIcon.x+20 && bird.y>shieldIcon.y-20 && bird.y<shieldIcon.y+20){
            shieldActive=true; shieldTimer=7000; shieldIcon=null; speed+=1;
        }
    }

    if(shieldActive){
        ctx.fillStyle="white"; ctx.font="18px Arial";
        ctx.fillText("Shield: "+Math.ceil(shieldTimer/1000)+"s",10,30);
        shieldTimer-=dt; if(shieldTimer<=0) shieldActive=false;
    }

    ctx.fillStyle="black"; ctx.font="20px Arial";
    ctx.fillText("Score: "+score,canvas.width-120,30);

    anim=requestAnimationFrame(loop);
}
</script>
</body>
</html>
