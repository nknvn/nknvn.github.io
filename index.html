<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Snake Ultimate</title>
<style>
body {
    margin:0;
    background:#111;
    color:white;
    font-family:Arial;
    text-align:center;
}

canvas {
    background:#222;
    display:block;
    margin:20px auto;
    border:3px solid #555;
}

#menu, #gameOver {
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
}

button {
    padding:10px 20px;
    font-size:18px;
    margin-top:10px;
    cursor:pointer;
}
</style>
</head>
<body>

<h1>üêç Snake Ultimate</h1>
<div>Score: <span id="score">0</span> | High Score: <span id="high">0</span> | Level: <span id="level">1</span></div>

<canvas id="game" width="400" height="400"></canvas>

<div id="menu">
    <h2>Start Game</h2>
    <button onclick="startGame()">Play</button>
</div>

<div id="gameOver" style="display:none">
    <h2>Game Over</h2>
    <button onclick="startGame()">Restart</button>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const box = 20;
let snake, food, direction, score, level, speed, obstacles, interval, paused;

let highScore = localStorage.getItem("snakeHigh") || 0;
document.getElementById("high").innerText = highScore;

// ===== SOUND =====
const eatSound = new Audio("https://actions.google.com/sounds/v1/cartoon/pop.ogg");
const loseSound = new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg");

// ===== INIT GAME =====
function startGame(){
    snake = [{x:10,y:10}];
    direction = "RIGHT";
    score = 0;
    level = 1;
    speed = 150;
    paused = false;

    obstacles = [];
    generateFood();
    generateObstacles();

    document.getElementById("menu").style.display="none";
    document.getElementById("gameOver").style.display="none";

    clearInterval(interval);
    interval = setInterval(draw, speed);
}

// ===== FOOD =====
function generateFood(){
    food = {
        x: Math.floor(Math.random()*20),
        y: Math.floor(Math.random()*20)
    };
}

// ===== OBSTACLES =====
function generateObstacles(){
    obstacles = [];
    for(let i=0;i<level+2;i++){
        obstacles.push({
            x: Math.floor(Math.random()*20),
            y: Math.floor(Math.random()*20)
        });
    }
}

// ===== INPUT =====
document.addEventListener("keydown", e=>{
    if(e.key==="ArrowUp" && direction!="DOWN") direction="UP";
    else if(e.key==="ArrowDown" && direction!="UP") direction="DOWN";
    else if(e.key==="ArrowLeft" && direction!="RIGHT") direction="LEFT";
    else if(e.key==="ArrowRight" && direction!="LEFT") direction="RIGHT";
    else if(e.key===" ") togglePause();
});

// ===== PAUSE =====
function togglePause(){
    paused = !paused;
}

// ===== DRAW =====
function draw(){
    if(paused) return;

    ctx.fillStyle="#222";
    ctx.fillRect(0,0,400,400);

    // Draw snake
    for(let i=0;i<snake.length;i++){
        ctx.fillStyle = i==0 ? "lime" : "green";
        ctx.fillRect(snake[i].x*box, snake[i].y*box, box, box);
    }

    // Draw food
    ctx.fillStyle="red";
    ctx.fillRect(food.x*box, food.y*box, box, box);

    // Draw obstacles
    ctx.fillStyle="gray";
    obstacles.forEach(o=>{
        ctx.fillRect(o.x*box, o.y*box, box, box);
    });

    // Move snake
    let head = {x: snake[0].x, y: snake[0].y};

    if(direction==="UP") head.y--;
    if(direction==="DOWN") head.y++;
    if(direction==="LEFT") head.x--;
    if(direction==="RIGHT") head.x++;

    // ===== COLLISION =====
    if(
        head.x<0 || head.y<0 || head.x>=20 || head.y>=20 ||
        snake.some(s=>s.x===head.x && s.y===head.y) ||
        obstacles.some(o=>o.x===head.x && o.y===head.y)
    ){
        gameOver();
        return;
    }

    // Eat food
    if(head.x===food.x && head.y===food.y){
        score++;
        eatSound.play();
        generateFood();

        // Level up m·ªói 5 ƒëi·ªÉm
        if(score % 5 === 0){
            level++;
            speed -= 10;
            generateObstacles();
            clearInterval(interval);
            interval = setInterval(draw, speed);
        }
    }else{
        snake.pop();
    }

    snake.unshift(head);

    // Update UI
    document.getElementById("score").innerText = score;
    document.getElementById("level").innerText = level;
}

// ===== GAME OVER =====
function gameOver(){
    clearInterval(interval);
    loseSound.play();

    if(score > highScore){
        highScore = score;
        localStorage.setItem("snakeHigh", highScore);
        document.getElementById("high").innerText = highScore;
    }

    document.getElementById("gameOver").style.display="block";
}

</script>
</body>
</html>
