<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Game B·∫£o V·ªá C√¥ G√°i - Flappy Pro + Skin + Sound + Music</title>
<style>
html, body { margin:0; padding:0; background:#111; height:100%; overflow:hidden; font-family:Arial,sans-serif; color:white;}
#start-screen, #game-over-screen { position:absolute; inset:0; background:#000000cc; display:flex; flex-direction:column; justify-content:center; align-items:center; gap:20px; font-size:28px; z-index:10;}
button { padding:12px 20px; font-size:20px; border-radius:10px; border:none; cursor:pointer; background:#00c8ff; color:black; font-weight:bold;}
#jump-btn { display:none; position:absolute; bottom:20px; left:50%; transform:translateX(-50%); z-index:5;}
#shop-btn { position:absolute; top:20px; right:20px; z-index:5; font-size:18px;}
#shop { position:absolute; top:60px; right:20px; width:180px; background:#222; border:2px solid #00c8ff; border-radius:10px; padding:10px; display:none; z-index:6;}
.shop-item { display:flex; justify-content:space-between; margin:5px 0;}
canvas { background:#222; display:block; margin:0 auto;}
.name-tag { position:absolute; font-size:16px; color:yellow; text-shadow:1px 1px 2px black; pointer-events:none; white-space:nowrap;}
</style>
</head>
<body>

<div id="start-screen">
    <h2>Game B·∫£o V·ªá C√¥ G√°i</h2>
    <button id="start-btn">Start</button>
</div>

<div id="game-over-screen" style="display:none;">
    <h2>Thua r·ªìi!</h2>
    <p id="final-score"></p>
    <button id="restart-btn">Ch∆°i l·∫°i</button>
</div>

<canvas id="gameCanvas" width="420" height="600"></canvas>
<button id="jump-btn">BAY</button>
<button id="shop-btn">üõí Shop</button>
<div id="shop">
    <h3>Shop Skin</h3>
    <div class="shop-item" data-cost="10" data-color="pink">üå∏ H·ªìng - 10 ƒëi·ªÉm <button>Buy</button></div>
    <div class="shop-item" data-cost="20" data-color="cyan">üíß Xanh - 20 ƒëi·ªÉm <button>Buy</button></div>
    <div class="shop-item" data-cost="30" data-color="gold">‚≠ê V√†ng - 30 ƒëi·ªÉm <button>Buy</button></div>
</div>

<div id="name-container"></div>

<script>
const canvas=document.getElementById("gameCanvas");
const ctx=canvas.getContext("2d");

// Nh√¢n v·∫≠t
let girl={x:80, y:250, radius:18, velocity:0, color:"pink", angle:0, flash:false, flashTimer:0};

// V·∫≠t l√Ω
let gravity=0.35, jumpPower=-7;

// Pipes
let pipes=[], pipeGap=160, pipeWidth=60, pipeSpeed=2.5;
let score=0, running=false, spawnTimer=0;
const nameContainer=document.getElementById("name-container");
const randomNames=["Noob","ProVip","ThanhNi√™nC·ª©ng","G√°iXinh","Boy1m85","SiuNhan"];

// Shop
const shopBtn=document.getElementById("shop-btn");
const shopDiv=document.getElementById("shop");
shopBtn.addEventListener("click",()=>{shopDiv.style.display = shopDiv.style.display==="none"?"block":"none";});

/* ======= √ÇM THANH ======= */
const soundJump = new Audio("data:audio/wav;base64,UklGRhIAAABXQVZFZm10IBAAAAABAAEAQB8AAIA+AAACABAAZGF0YQgAAAAA");
const soundHit = new Audio("data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAIA+AAACABAAZGF0YQgAAAAA");
const soundBuy  = new Audio("data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAIA+AAACABAAZGF0YQgAAAAA");
const soundPoint = new Audio("data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAIA+AAACABAAZGF0YQgAAAAA");
const bgMusic = new Audio("data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAIA+AAACABAAZGF0YQgAAAAA");
bgMusic.loop=true; bgMusic.volume=0.2;

/* SPAWN PIPE */
function spawnPipe(){
    const topHeight=Math.random()*250+50;
    const bottomHeight=canvas.height - topHeight - pipeGap;
    const id=Math.random().toString(36).substring(2,9);
    pipes.push({x:canvas.width, topHeight, bottomHeight, id, offset:Math.random()*10});
    const nameTag=document.createElement("div");
    nameTag.className="name-tag"; nameTag.id="name-"+id;
    nameTag.innerText=randomNames[Math.floor(Math.random()*randomNames.length)];
    nameContainer.appendChild(nameTag);
}

/* START GAME */
document.getElementById("start-btn").addEventListener("click",()=>{
    document.getElementById("start-screen").style.display="none";
    document.getElementById("jump-btn").style.display="block";
    bgMusic.play();
    initGame();
});
document.getElementById("jump-btn").addEventListener("click",()=>{jump(); soundJump.play();});
document.addEventListener("keydown", e=>{if(e.code==="Space"){jump(); soundJump.play();}});
document.getElementById("restart-btn").addEventListener("click",()=> location.reload());

function jump(){ girl.velocity=jumpPower; }

/* SHOP */
document.querySelectorAll(".shop-item").forEach(item=>{
    const btn=item.querySelector("button");
    btn.addEventListener("click",()=>{
        const cost=parseInt(item.dataset.cost);
        if(score>=cost){ 
            girl.color=item.dataset.color; 
            girl.flash=true; girl.flashTimer=0;
            score-=cost; 
            soundBuy.play();
        } else alert("Kh√¥ng ƒë·ªß ƒëi·ªÉm!");
    });
});

/* INIT GAME */
function initGame(){ girl.y=250; girl.velocity=0; pipes=[]; score=0; running=true; spawnTimer=0; spawnPipe(); requestAnimationFrame(gameLoop); }

/* GAME LOOP */
function gameLoop(){
    if(!running) return;
    ctx.clearRect(0,0,canvas.width,canvas.height);

    girl.velocity+=gravity;
    girl.y+=girl.velocity;
    girl.angle=Math.max(Math.min(girl.velocity*5,25),-25);

    if(girl.flash){
        girl.flashTimer +=16.6;
        ctx.fillStyle=(Math.floor(girl.flashTimer/100)%2===0)?"white":girl.color;
        if(girl.flashTimer>1000) girl.flash=false;
    } else ctx.fillStyle=girl.color;

    ctx.save();
    ctx.translate(girl.x+girl.radius, girl.y+girl.radius);
    ctx.rotate(girl.angle*Math.PI/180);
    ctx.beginPath();
    ctx.arc(0,0,girl.radius,0,Math.PI*2);
    ctx.fill();
    ctx.closePath();
    ctx.restore();

    pipeSpeed+=0.0006;
    spawnTimer+=16.6;
    if(spawnTimer>=1600){ spawnPipe(); spawnTimer=0; }

    for(let i=pipes.length-1;i>=0;i--){
        const pipe=pipes[i];
        pipe.x-=pipeSpeed;
        const topOsc=Math.sin(Date.now()/500 + pipe.offset)*5;
        const bottomOsc=Math.sin(Date.now()/500 + pipe.offset+1)*5;

        ctx.fillStyle="green";
        ctx.fillRect(pipe.x,0,pipeWidth,pipe.topHeight+topOsc);
        ctx.fillRect(pipe.x,canvas.height-pipe.bottomHeight+bottomOsc,pipeWidth,pipe.bottomHeight);

        const nameDiv=document.getElementById("name-"+pipe.id);
        if(nameDiv){ 
            nameDiv.style.left=(pipe.x+pipeWidth/2-nameDiv.offsetWidth/2)+"px";
            nameDiv.style.top=(canvas.height-pipe.bottomHeight-30+bottomOsc)+"px";
        }

        if(girl.x+girl.radius>pipe.x && girl.x<pipe.x+pipeWidth &&
           (girl.y<pipe.topHeight+topOsc || girl.y+girl.radius*2>canvas.height-pipe.bottomHeight+bottomOsc)){
            soundHit.play();
            gameOver();
        }

        if(pipe.x+pipeWidth<0){ 
            if(nameDiv) nameDiv.remove(); 
            pipes.splice(i,1); 
            score++; 
            soundPoint.play();
        }
    }

    if(girl.y+girl.radius*2>=canvas.height){ soundHit.play(); gameOver();}

    ctx.fillStyle="white"; ctx.font="26px Arial";
    ctx.fillText("ƒêi·ªÉm: "+score,10,30);

    requestAnimationFrame(gameLoop);
}

/* GAME OVER */
function gameOver(){
    running=false;
    pipes.forEach(p=>{
        const t=document.getElementById("name-"+p.id);
        if(t) t.remove();
    });
    document.getElementById("final-score").innerText="ƒêi·ªÉm c·ªßa b·∫°n: "+score;
    document.getElementById("game-over-screen").style.display="flex";
    document.getElementById("jump-btn").style.display="none";
    bgMusic.pause();
}
</script>
</body>
    </html>
