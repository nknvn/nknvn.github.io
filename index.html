<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Game parkour của ah khôi đz</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: linear-gradient(#0a0a0a, #000);
            font-family: Arial, sans-serif;
        }
        #titleScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            background: rgba(0,0,0,0.75);
            backdrop-filter: blur(6px);
            z-index: 10;
            color: white;
            text-align: center;
        }
        #titleScreen h1 {
            font-size: 55px;
            text-shadow: 0 0 15px cyan, 0 0 35px cyan;
            margin-bottom: 25px;
        }
        #startBtn {
            padding: 18px 45px;
            font-size: 24px;
            background: cyan;
            color: black;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 0 15px cyan;
        }
        #startBtn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 25px cyan;
        }
        #hud {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            font-size: 24px;
            text-shadow: 0 0 10px black;
            z-index: 5;
        }
        canvas {
            display: block;
        }
    </style>
</head>
<body>

    <!-- HUD -->
    <div id="hud">Điểm: 0</div>

    <!-- Màn hình bắt đầu -->
    <div id="titleScreen">
        <h1>GAME PARKOUR CỦA AH KHÔI ĐZ</h1>
        <button id="startBtn">BẮT ĐẦU</button>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const scoreBox = document.getElementById("hud");

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resize();
        window.addEventListener("resize", resize);

        // Player head
        let head = {
            x: 200,
            y: 250,
            radius: 30,
            dy: 0,
            onGround: false,
            spin: 0,
            alive: true
        };

        let gravity = 0.7;
        let jumpForce = -14;
        let speed = 7;
        let offsetX = 0;
        let score = 0;

        // Platforms
        let platforms = [];
        for (let i = 0; i < 120; i++) {
            platforms.push({
                x: i * 300,
                y: 350 + Math.sin(i * 0.5) * 100,
                w: 260,
                h: 25
            });
        }

        // Traps (gai)
        let traps = [];
        for (let i = 5; i < 100; i += 7) {
            traps.push({
                x: i * 300 + 150,
                y: 340 + Math.sin(i * 0.5) * 100 - 30,
                size: 30
            });
        }

        // Particles khi chết
        let particles = [];

        let keys = {};
        document.addEventListener("keydown", (e) => keys[e.key] = true);
        document.addEventListener("keyup", (e) => keys[e.key] = false);

        function startGame() {
            document.getElementById("titleScreen").style.display = "none";
            gameLoop();
        }
        document.getElementById("startBtn").onclick = startGame;

        function addParticles(x, y) {
            for (let i = 0; i < 25; i++) {
                particles.push({
                    x, y,
                    dx: (Math.random() - 0.5) * 10,
                    dy: (Math.random() - 0.5) * 10,
                    life: 50
                });
            }
        }

        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (head.alive) {
                if (keys["ArrowRight"] || keys["d"]) offsetX += speed;
                if (keys["ArrowLeft"] || keys["a"]) offsetX -= speed;

                if ((keys["ArrowUp"] || keys["w"] || keys[" "]) && head.onGround) {
                    head.dy = jumpForce;
                    head.onGround = false;
                }

                head.dy += gravity;
                head.y += head.dy;
                head.spin += 0.2;

                head.onGround = false;
                for (let p of platforms) {
                    let px = p.x - offsetX;
                    if (head.x + head.radius > px && head.x - head.radius < px + p.w && head.y + head.radius > p.y && head.y + head.radius < p.y + p.h && head.dy > 0) {
                        head.y = p.y - head.radius;
                        head.dy = 0;
                        head.onGround = true;
                    }
                }

                // Va chạm gai
                for (let t of traps) {
                    let tx = t.x - offsetX;
                    if (Math.abs(head.x - tx) < t.size && Math.abs(head.y - t.y) < t.size) {
                        head.alive = false;
                        addParticles(head.x, head.y);
                    }
                }

                score = Math.floor(offsetX / 10);
                scoreBox.textContent = "Điểm: " + score;
            }

            // Draw platforms
            ctx.fillStyle = "cyan";
            for (let p of platforms) ctx.fillRect(p.x - offsetX, p.y, p.w, p.h);

            // Draw traps
            ctx.fillStyle = "red";
            traps.forEach(t => ctx.fillRect(t.x - offsetX - 15, t.y - 15, 30, 30));

            // Draw player
            if (head.alive) {
                ctx.save();
                ctx.translate(head.x, head.y);
                ctx.rotate(head.spin);
                ctx.fillStyle = "white";
                ctx.beginPath();
                ctx.arc(0, 0, head.radius, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }

            // Particles
            ctx.fillStyle = "yellow";
            particles.forEach((p, i) => {
                p.x += p.dx;
                p.y += p.dy;
                p.life--;
                ctx.fillRect(p.x, p.y, 5, 5);
                if (p.life <= 0) particles.splice(i, 1);
            });

            requestAnimationFrame(gameLoop);
        }
    </script>

</body>
</html>
