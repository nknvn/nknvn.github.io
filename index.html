<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Game Parkour Full</title>
<style>
  html, body {margin:0; padding:0; overflow:hidden; background:#000;}
  canvas {display:block;}
</style>
</head>
<body>
<canvas id="gameCanvas" width="800" height="500"></canvas>

<script>
// ==================== PHẦN 1 ====================
// <!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PARKOUR ULTIMATE SOUL — GOD MODE 6.0 VERBOSE 2600+</title>

<!-- =====================
     GLOBAL CSS STYLES
===================== -->
<style>
/* RESET MARGIN/PADDING/OVERFLOW */
html, body {
    margin: 0;               /* loại bỏ margin mặc định */
    padding: 0;              /* loại bỏ padding mặc định */
    overflow: hidden;        /* ẩn thanh cuộn */
    font-family: 'Press Start 2P', monospace; /* font retro neon */
    background: #000;        /* nền đen */
    touch-action: none;      /* disable gesture zoom on mobile */
}

/* CANVAS GAME */
canvas#gameCanvas {
    display: block;          /* loại bỏ khoảng trắng */
    background: #000;        /* nền đen */
}

/* UI LAYER */
#uiLayer {
    position: fixed;          /* luôn ở trên canvas */
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;     /* cho phép click qua canvas */
    z-index: 100;             /* trên tất cả */
}

/* SCREENS: MENU, DEATH, SHOP, BOSS INTRO */
#menuScreen, #deathScreen, #shopScreen, #bossIntro {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;            /* dùng flexbox */
    justify-content: center;
    align-items: center;
    flex-direction: column;   /* stacked vertically */
    background: rgba(0,0,0,0.85);
    color: #0ff;
    font-size: 2em;
    z-index: 100;
    transition: opacity 0.5s; /* fade */
    opacity: 1;
}

/* HIDDEN SCREENS */
#menuScreen.hide,
#deathScreen.hide,
#shopScreen.hide,
#bossIntro.hide {
    opacity: 0;
    pointer-events: none;
}

/* BUTTON STYLE */
button.uiButton {
    margin: 10px;
    padding: 15px 30px;
    background: #0ff;
    color: #000;
    border: none;
    border-radius: 10px;
    font-size: 1em;
    transition: 0.2s;
}

/* HOVER EFFECT */
button.uiButton:hover {
    background: #0aa;
    color: #fff;
}

/* MOBILE CONTROLS */
#mobileControls {
    position: fixed;
    bottom: 20px;
    width: 100%;
    display: flex;
    justify-content: space-around;
    z-index: 99;
}

.mobileBtn {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: rgba(0,255,255,0.3);
    border: 2px solid #0ff;
    touch-action: none;
}

.mobileBtn:active {
    background: rgba(0,255,255,0.7);
}

/* BIOME OVERLAY */
#biomeOverlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    mix-blend-mode: overlay;
    pointer-events: none;
}

/* PARTICLE SYSTEM */
.particle {
    position: absolute;
    pointer-events: none;
    width: 5px;
    height: 5px;
    border-radius: 50%;
    background: #fff;
}

/* FONT IMPORT */
@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

/* BODY FONT */
body {
    font-family: 'Press Start 2P', monospace;
}

/* HIDE AUDIO ELEMENTS */
audio {
    display: none;
}

</style>
</head>
<body>

<!-- =====================
     CANVAS FOR GAME
===================== -->
<canvas id="gameCanvas"></canvas>

<!-- =====================
     UI LAYER
===================== -->
<div id="uiLayer">

    <!-- MENU SCREEN -->
    <div id="menuScreen">
        <div>PARKOUR ULTIMATE SOUL<br>GOD MODE 6.0 VERBOSE</div>
        <button class="uiButton" onclick="startGame()">START</button>
    </div>

    <!-- DEATH SCREEN -->
    <div id="deathScreen" class="hide">
        <div>YOU DIED</div>
        <button class="uiButton" onclick="restartGame()">RETRY</button>
    </div>

    <!-- SHOP SCREEN -->
    <div id="shopScreen" class="hide">
        <div>SHOP</div>
        <button class="uiButton" onclick="buyUpgrade('speed')">SPEED</button>
        <button class="uiButton" onclick="buyUpgrade('jump')">JUMP</button>
        <button class="uiButton" onclick="buyUpgrade('dash')">DASH</button>
        <button class="uiButton" onclick="buyUpgrade('shield')">SHIELD</button>
        <button class="uiButton" onclick="buyUpgrade('revive')">REVIVE</button>
        <button class="uiButton" onclick="buyUpgrade('skin')">SKIN</button>
        <button class="uiButton" onclick="closeShop()">BACK</button>
    </div>

    <!-- BOSS INTRO SCREEN -->
    <div id="bossIntro" class="hide">
        <div id="bossName">BOSS</div>
    </div>

    <!-- MOBILE CONTROLS -->
    <div id="mobileControls">
        <div class="mobileBtn" id="leftBtn">◀</div>
        <div class="mobileBtn" id="jumpBtn">▲</div>
        <div class="mobileBtn" id="dashBtn">▶</div>
    </div>

    <!-- BIOME OVERLAY -->
    <div id="biomeOverlay"></div>

</div>

<!-- =====================
     AUDIO ELEMENTS
===================== -->
<audio id="bgMusic" loop src="bgm.mp3"></audio>
<audio id="jumpSnd" src="jump.wav"></audio>
<audio id="dashSnd" src="dash.wav"></audio>
<audio id="hitSnd" src="hit.wav"></audio>
<audio id="bossSnd" src="boss.wav"></audio>
<audio id="coinSnd" src="coin.wav"></audio>

<script>
// =====================
/* GOD MODE 6.0 VERBOSE SCRIPT
   PHẦN 1: GLOBAL VARIABLES
===================== */
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

/* CANVAS SIZE */
let width = canvas.width = window.innerWidth;
let height = canvas.height = window.innerHeight;

/* GAME STATE */
let gameState = 'menu';  // menu, playing, death, shop
let keys = {};            // object lưu key đang nhấn
let player = {};          // player object
let platforms = [];       // mảng platforms
let enemies = [];         // mảng enemies
let particles = [];       // mảng particle
let biomes = [];          // mảng biome
let currentBiome = 0;     // biome hiện tại
let camera = {x:0, y:0};  // camera offset
let upgrades = {speed:0, jump:0, dash:0, shield:false, revive:0, skin:0};  // upgrades
let audio = {};           // audio objects
let lastTime = 0;         // thời gian loop trước
let bosses = [];          // mảng boss
let boss = null;          // active boss



// ==================== PHẦN 2 ====================
// Biến và trạng thái riêng cho phần 2
let part2Player = {x: 100, y: 300, width: 50, height: 50, color: 'blue', vy: 0, onGround: true};
let part2Platforms = [];
let part2Gravity = 0.8;

// Khởi tạo các platforms
function part2Init() {
    part2Platforms = [
        {x: 0, y: 400, width: 800, height: 20},
        {x: 150, y: 300, width: 100, height: 20},
        {x: 350, y: 250, width: 100, height: 20},
        {x: 550, y: 200, width: 100, height: 20},
    ];
}

// Cập nhật trạng thái player
function part2Update() {
    if (!part2Player.onGround) part2Player.vy += part2Gravity;
    part2Player.y += part2Player.vy;

    part2Player.onGround = false;
    part2Platforms.forEach(p => {
        if (part2Player.x < p.x + p.width &&
            part2Player.x + part2Player.width > p.x &&
            part2Player.y + part2Player.height > p.y &&
            part2Player.y + part2Player.height < p.y + p.height + 10 &&
            part2Player.vy >= 0) {
            part2Player.y = p.y - part2Player.height;
            part2Player.vy = 0;
            part2Player.onGround = true;
        }
    });
}

// Vẽ phần 2
function part2Draw(ctx) {
    ctx.fillStyle = part2Player.color;
    ctx.fillRect(part2Player.x, part2Player.y, part2Player.width, part2Player.height);

    ctx.fillStyle = 'green';
    part2Platforms.forEach(p => {
        ctx.fillRect(p.x, p.y, p.width, p.height);
    });
}

// Xử lý phím (phần 2 riêng)
function part2KeyDown(e) {
    if (e.code === 'ArrowLeft') part2Player.x -= 10;
    if (e.code === 'ArrowRight') part2Player.x += 10;
    if (e.code === 'Space' && part2Player.onGround) {
        part2Player.vy = -15;
        part2Player.onGround = false;
    }
}

function part2KeyUp(e) {}

// Gọi init một lần
part2Init();

// Hàm gọi trong main loop
function part2Loop(ctx) {
    part2Update();
    part2Draw(ctx);
}

// Thêm event listener (chỉ thêm 1 lần)
window.addEventListener('keydown', part2KeyDown);
window.addEventListener('keyup', part2KeyUp);

// ==================== MAIN LOOP ====================
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

function mainLoop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // Gọi các phần
    // phần 1: mainLoopPart1(ctx);
    part2Loop(ctx);

    requestAnimationFrame(mainLoop);
}

mainLoop();
</script>

</body>
</html>
// ==================== PHẦN 3: FULL CHUẨN HÓA ====================

// Biến và trạng thái riêng cho phần 3
let part3Obstacles = [];
let part3Speed = 3;

// Khởi tạo obstacles
function part3Init() {
    for (let i = 0; i < 5; i++) {
        part3Obstacles.push({x: i * 200 + 800, y: 350, width: 30, height: 30});
    }
}

// Cập nhật obstacles
function part3Update() {
    part3Obstacles.forEach(obs => {
        obs.x -= part3Speed;
        if (obs.x + obs.width < 0) obs.x = 800 + Math.random() * 200;
    });
}

// Vẽ obstacles
function part3Draw(ctx) {
    ctx.fillStyle = 'orange';
    part3Obstacles.forEach(obs => {
        ctx.fillRect(obs.x, obs.y, obs.width, obs.height);
    });
}

// Kiểm tra va chạm với player của phần 2
function part3CheckCollision() {
    part3Obstacles.forEach(obs => {
        if (part2Player.x < obs.x + obs.width &&
            part2Player.x + part2Player.width > obs.x &&
            part2Player.y < obs.y + obs.height &&
            part2Player.y + part2Player.height > obs.y) {
            // Va chạm: reset player về đầu
            part2Player.x = 100;
            part2Player.y = 300;
            part2Player.vy = 0;
        }
    });
}

// Gọi init một lần
part3Init();

// Hàm gọi trong main loop
function part3Loop(ctx) {
    part3Update();
    part3CheckCollision();
    part3Draw(ctx);
}
// ==================== PHẦN 4: FULL CHUẨN HÓA ====================

// Biến và trạng thái riêng cho phần 4
let part4Coins = [];
let part4Collected = 0;

// Khởi tạo coins
function part4Init() {
    for (let i = 0; i < 5; i++) {
        part4Coins.push({x: i * 150 + 200, y: 270, width: 20, height: 20, collected: false});
    }
}

// Cập nhật trạng thái coins (kiểm tra thu thập)
function part4Update() {
    part4Coins.forEach(coin => {
        if (!coin.collected &&
            part2Player.x < coin.x + coin.width &&
            part2Player.x + part2Player.width > coin.x &&
            part2Player.y < coin.y + coin.height &&
            part2Player.y + part2Player.height > coin.y) {
            coin.collected = true;
            part4Collected++;
        }
    });
}

// Vẽ coins
function part4Draw(ctx) {
    ctx.fillStyle = 'yellow';
    part4Coins.forEach(coin => {
        if (!coin.collected) {
            ctx.fillRect(coin.x, coin.y, coin.width, coin.height);
        }
    });

    // Hiển thị điểm số
    ctx.fillStyle = 'white';
    ctx.font = '20px Arial';
    ctx.fillText('Coins: ' + part4Collected, 10, 30);
}

// Gọi init một lần
part4Init();

// Hàm gọi trong main loop
function part4Loop(ctx) {
    part4Update();
    part4Draw(ctx);
}
// ==================== PHẦN 5: FULL CHUẨN HÓA ====================

// Biến và trạng thái boss
let part5Boss = {x: 700, y: 150, width: 80, height: 80, color: 'purple', vx: 2};
let part5BossHealth = 5;

// Khởi tạo boss
function part5Init() {
    part5Boss.x = 700;
    part5Boss.y = 150;
    part5BossHealth = 5;
}

// Cập nhật boss
function part5Update() {
    // Di chuyển ngang
    part5Boss.x += part5Boss.vx;
    if (part5Boss.x <= 400 || part5Boss.x + part5Boss.width >= 780) {
        part5Boss.vx *= -1;
    }

    // Va chạm với player (phần 2)
    if (part2Player.x < part5Boss.x + part5Boss.width &&
        part2Player.x + part2Player.width > part5Boss.x &&
        part2Player.y < part5Boss.y + part5Boss.height &&
        part2Player.y + part2Player.height > part5Boss.y) {
        // Reset player
        part2Player.x = 100;
        part2Player.y = 300;
        part2Player.vy = 0;

        // Giảm máu boss
        part5BossHealth--;
        if (part5BossHealth < 0) part5BossHealth = 0;
    }
}

// Vẽ boss và hiệu ứng
function part5Draw(ctx) {
    // Boss
    ctx.fillStyle = part5Boss.color;
    ctx.fillRect(part5Boss.x, part5Boss.y, part5Boss.width, part5Boss.height);

    // HP boss
    ctx.fillStyle = 'white';
    ctx.font = '20px Arial';
    ctx.fillText('Boss HP: ' + part5BossHealth, 600, 30);

    // Hiệu ứng khi boss bị đánh bại
    if (part5BossHealth === 0) {
        ctx.fillStyle = 'red';
        ctx.font = '40px Arial';
        ctx.fillText('BOSS DEFEATED!', 250, 250);
    }
}

// Gọi init một lần
part5Init();

// Hàm gọi trong main loop
function part5Loop(ctx) {
    if (part5BossHealth > 0) part5Update();
    part5Draw(ctx);
}

